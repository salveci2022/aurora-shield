<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Aurora-Shield ¬∑ Confidente</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background: #1a1e2b;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 12px;
        }

        .phone-panel {
            max-width: 400px;
            width: 100%;
            background: #f8f5f2;
            border-radius: 40px;
            padding: 24px 20px 32px 20px;
            box-shadow: 0 30px 50px rgba(0, 0, 0, 0.4), 0 0 0 10px #3a2e28;
            border: 2px solid #b7a08b;
        }

        .header-protected {
            display: flex;
            flex-direction: column;
            margin-bottom: 24px;
        }

        .main-title {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: -0.5px;
            color: #231f1b;
            line-height: 1;
        }

        .main-title span {
            font-weight: 400;
            font-size: 16px;
            color: #b3597a;
            margin-left: 8px;
        }

        .aurora-badge {
            font-size: 14px;
            font-weight: 500;
            color: #b3597a;
            background: #f2dfe8;
            padding: 6px 14px;
            border-radius: 40px;
            align-self: flex-start;
            margin-top: 6px;
            border: 1px solid #dbb2c5;
        }

        .emergency-alert {
            background: #c32f3b;
            border-radius: 28px;
            padding: 18px;
            margin-bottom: 20px;
            border: 3px solid #ffb3aa;
            box-shadow: 0 8px 0 #731f26;
            color: white;
            transition: all 0.3s ease;
        }

        .emergency-alert.inactive {
            background: #4A148C;
            border-color: #B39DDB;
            box-shadow: 0 8px 0 #2a0a4a;
        }

        .emergency-title {
            font-size: 24px;
            font-weight: 900;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 0 #540f16;
            margin-bottom: 16px;
        }

        .emergency-detail {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 14px;
            border: 1px solid #ffb3aa;
        }

        .detail-row {
            display: flex;
            margin-bottom: 8px;
        }

        .detail-label {
            font-weight: 600;
            width: 90px;
            color: #ffe6e3;
        }

        .detail-value {
            font-weight: 800;
            color: white;
            flex: 1;
        }

        .sirene-section {
            background: linear-gradient(145deg, #F8F3FF 0%, #F0E8FF 100%);
            border-radius: 28px;
            padding: 18px 16px;
            margin-bottom: 20px;
            border: 1px solid #D8C5FF;
            box-shadow: 0 8px 20px rgba(106, 27, 154, 0.15);
        }

        .sirene-title {
            font-size: 15px;
            font-weight: 700;
            color: #4A148C;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .sirene-status {
            background: #c32f3b;
            color: white;
            padding: 16px;
            border-radius: 40px;
            font-weight: 800;
            font-size: 18px;
            text-align: center;
            margin-bottom: 12px;
            border: 2px solid #ffb3aa;
            box-shadow: 0 4px 0 #731f26;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s ease;
        }

        .sirene-status.inactive {
            background: #4A148C;
            border-color: #B39DDB;
            box-shadow: 0 4px 0 #2a0a4a;
        }

        .sirene-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .sirene-btn {
            flex: 1;
            min-width: 110px;
            background: white;
            border: none;
            padding: 14px 0;
            border-radius: 40px;
            font-weight: 800;
            font-size: 14px;
            color: #4A148C;
            box-shadow: 0 4px 0 #7B5BA7;
            border: 2px solid #B39DDB;
            text-align: center;
            cursor: pointer;
            transition: 0.05s linear;
            text-transform: uppercase;
        }

        .sirene-btn:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #7B5BA7;
        }

        .sirene-btn.emergency {
            background: #c32f3b;
            color: white;
            box-shadow: 0 4px 0 #731f26;
            border: 2px solid #ffb3aa;
        }

        .sirene-btn.emergency:active {
            box-shadow: 0 1px 0 #731f26;
        }

        .map-section {
            background: #f4ede7;
            border-radius: 24px;
            padding: 16px;
            border: 1px solid #d8c3b6;
            margin-bottom: 20px;
        }

        .map-title {
            font-weight: 700;
            margin-bottom: 12px;
            color: #3e2c21;
            font-size: 15px;
        }

        .map-container {
            background: #dac2b2;
            border-radius: 20px;
            padding: 16px;
            border: 1px solid #b5947e;
            margin-bottom: 12px;
            text-align: center;
        }

        .map-placeholder {
            background: #a48d7c;
            height: 120px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            border: 2px solid #6b4f3f;
            margin-bottom: 12px;
            background-image: radial-gradient(circle at 20px 20px, #8b6f5e 2px, transparent 2px), 
                              radial-gradient(circle at 60px 80px, #8b6f5e 2px, transparent 2px);
            background-size: 40px 40px;
        }

        .coordinates {
            background: #f1e1d6;
            padding: 12px;
            border-radius: 30px;
            font-family: monospace;
            font-weight: 700;
            font-size: 16px;
            color: #1f130c;
            border: 1px solid #b5947e;
            margin-bottom: 12px;
            text-align: center;
        }

        .map-link {
            background: #4f7960;
            color: white;
            padding: 14px;
            border-radius: 40px;
            text-align: center;
            font-weight: 800;
            text-decoration: none;
            display: block;
            border: 2px solid #89b78a;
            box-shadow: 0 4px 0 #2d5a3a;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 14px;
            transition: 0.05s linear;
        }

        .map-link:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #2d5a3a;
        }

        .map-link.disabled {
            background: #8b6f5e;
            border-color: #6b4f3f;
            box-shadow: 0 4px 0 #4d3a2e;
            pointer-events: none;
            opacity: 0.5;
        }

        .map-credit {
            font-size: 11px;
            color: #8b6f5e;
            text-align: center;
            margin-top: 12px;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 20px 0 10px;
        }

        .action-btn {
            background: #e6d5ca;
            border: none;
            padding: 16px 20px;
            border-radius: 50px;
            font-weight: 800;
            font-size: 16px;
            color: #352217;
            box-shadow: 0 4px 0 #b19482;
            border: 1px solid #ccb5a6;
            flex: 1;
            text-align: center;
            cursor: pointer;
            transition: 0.05s linear;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .action-btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 #b19482;
        }

        .action-btn.limpar {
            background: #d0b9ab;
        }

        .footer-info {
            text-align: center;
            margin-top: 16px;
            font-size: 11px;
            color: #aa8877;
        }

        .sirene-btn:disabled {
            opacity: 0.5;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="phone-panel">
        <div class="header-protected">
            <div class="main-title">
                AURORA-SHIELD <span>¬∑ confidente</span>
            </div>
            <div class="aurora-badge">
                ‚ú¶ Painel de Emerg√™ncia ‚ú¶
            </div>
        </div>

        <div class="emergency-alert" id="emergencyAlert">
            <div class="emergency-title" id="emergencyTitle">üö® ALERTA DE EMERG√äNCIA!</div>
            <div class="emergency-detail" id="emergencyDetail">
                <div class="detail-row">
                    <span class="detail-label">NOME:</span>
                    <span class="detail-value" id="alertaNome">---</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">SITUA√á√ÉO:</span>
                    <span class="detail-value" id="alertaSituacao">---</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">DATA/HORA:</span>
                    <span class="detail-value" id="alertaData">---</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">MENSAGEM:</span>
                    <span class="detail-value" id="alertaMensagem">---</span>
                </div>
            </div>
        </div>

        <div class="sirene-section">
            <div class="sirene-title">üîä CONTROLE DA SIRENE</div>
            <div id="sireneStatus" class="sirene-status inactive">‚ö´ SIRENE DESATIVADA</div>
            <div class="sirene-buttons">
                <button id="ativarSirene" class="sirene-btn emergency">ATIVAR SIRENE</button>
                <button id="desativarSirene" class="sirene-btn">DESATIVAR</button>
                <button id="testarSom" class="sirene-btn">TESTAR</button>
            </div>
        </div>

        <div class="map-section">
            <div class="map-title">üìç LOCALIZA√á√ÉO DA V√çTIMA</div>
            <div class="map-container">
                <div class="map-placeholder" id="mapPlaceholder">
                    üó∫Ô∏è AGUARDANDO ALERTA
                </div>
                <div class="coordinates" id="coordenadas">
                    ---, ---
                </div>
                <a id="mapLink" href="#" target="_blank" class="map-link disabled">
                    ABRIR NO GOOGLE MAPS
                </a>
            </div>
            <div class="map-credit">
                Santa Maria ‚Ä¢ Em tempo real | ¬© OpenStreetMap
            </div>
        </div>

        <div class="action-buttons">
            <button id="limparAlerta" class="action-btn limpar">LIMPAR</button>
            <button id="reiniciarAlerta" class="action-btn">REINICIAR</button>
        </div>

        <div class="footer-info">
            Aurora-Shield ‚Ä¢ Sistema de Prote√ß√£o Ativa ‚Ä¢ <span id="statusConexao">üü¢ Monitorando</span>
        </div>
    </div>

    <script>
        // Elementos do DOM
        const emergencyAlert = document.getElementById('emergencyAlert');
        const emergencyTitle = document.getElementById('emergencyTitle');
        const alertaNome = document.getElementById('alertaNome');
        const alertaSituacao = document.getElementById('alertaSituacao');
        const alertaData = document.getElementById('alertaData');
        const alertaMensagem = document.getElementById('alertaMensagem');
        
        const sireneStatus = document.getElementById('sireneStatus');
        const btnAtivar = document.getElementById('ativarSirene');
        const btnDesativar = document.getElementById('desativarSirene');
        const btnTestar = document.getElementById('testarSom');
        const btnLimpar = document.getElementById('limparAlerta');
        const btnReiniciar = document.getElementById('reiniciarAlerta');
        
        const mapPlaceholder = document.getElementById('mapPlaceholder');
        const coordenadas = document.getElementById('coordenadas');
        const mapLink = document.getElementById('mapLink');
        const statusConexao = document.getElementById('statusConexao');

        // Vari√°veis de √°udio
        let audioContext = null;
        let oscilador = null;
        let ganho = null;
        let sireneAtiva = false;
        let efeitoVisual = null;
        let monitorInterval = null;

        // Fun√ß√µes de √°udio
        async function iniciarAudio() {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }
                
                oscilador = audioContext.createOscillator();
                ganho = audioContext.createGain();
                
                oscilador.type = 'sawtooth';
                oscilador.frequency.value = 620;
                ganho.gain.value = 0.3;
                
                oscilador.connect(ganho);
                ganho.connect(audioContext.destination);
                
                oscilador.start();
                
                return true;
            } catch (e) {
                console.error('Erro ao iniciar √°udio:', e);
                return false;
            }
        }

        function pararAudio() {
            if (oscilador) {
                try {
                    oscilador.stop();
                } catch (e) {}
                oscilador = null;
            }
            
            if (audioContext) {
                try {
                    audioContext.close();
                } catch (e) {}
                audioContext = null;
            }
        }

        function iniciarEfeitoVisual() {
            if (efeitoVisual) clearInterval(efeitoVisual);
            
            let corAlternada = false;
            efeitoVisual = setInterval(() => {
                if (sireneAtiva) {
                    sireneStatus.style.background = corAlternada ? '#c32f3b' : '#ff0000';
                    emergencyAlert.style.background = corAlternada ? '#c32f3b' : '#ff0000';
                    corAlternada = !corAlternada;
                }
            }, 300);
        }

        function pararEfeitoVisual() {
            if (efeitoVisual) {
                clearInterval(efeitoVisual);
                efeitoVisual = null;
            }
            sireneStatus.style.background = '';
            emergencyAlert.style.background = '';
        }

        async function ativarSirene() {
            if (sireneAtiva) return;
            
            sireneAtiva = true;
            const audioOk = await iniciarAudio();
            
            if (audioOk) {
                iniciarEfeitoVisual();
            }
            
            atualizarInterfaceSirene();
        }

        function desativarSirene() {
            sireneAtiva = false;
            pararAudio();
            pararEfeitoVisual();
            atualizarInterfaceSirene();
        }

        function testarSirene() {
            if (sireneAtiva) {
                alert('Sirene j√° est√° ativada!');
                return;
            }

            // Teste r√°pido de 2 segundos
            const testContext = new (window.AudioContext || window.webkitAudioContext)();
            const testOsc = testContext.createOscillator();
            const testGain = testContext.createGain();
            
            testOsc.type = 'sawtooth';
            testOsc.frequency.value = 620;
            testGain.gain.value = 0.2;
            
            testOsc.connect(testGain);
            testGain.connect(testContext.destination);
            
            testOsc.start();
            
            // Efeito visual do teste
            const originalColor = sireneStatus.style.background;
            let testFlash = true;
            const testInterval = setInterval(() => {
                sireneStatus.style.background = testFlash ? '#c32f3b' : '#ff0000';
                emergencyAlert.style.background = testFlash ? '#c32f3b' : '#ff0000';
                testFlash = !testFlash;
            }, 200);
            
            setTimeout(() => {
                testOsc.stop();
                testContext.close();
                clearInterval(testInterval);
                sireneStatus.style.background = originalColor;
                emergencyAlert.style.background = originalColor;
            }, 2000);
        }

        function atualizarInterfaceSirene() {
            if (sireneAtiva) {
                sireneStatus.innerHTML = 'üî¥ SIRENE ATIVADA';
                sireneStatus.classList.remove('inactive');
                btnAtivar.disabled = true;
                btnDesativar.disabled = false;
            } else {
                sireneStatus.innerHTML = '‚ö´ SIRENE DESATIVADA';
                sireneStatus.classList.add('inactive');
                btnAtivar.disabled = false;
                btnDesativar.disabled = true;
            }
        }

        // Atualizar alerta na interface
        function atualizarAlerta(alerta) {
            if (alerta && alerta.status === 'ativo') {
                // Mostrar alerta
                emergencyAlert.classList.remove('inactive');
                emergencyTitle.innerHTML = 'üö® ALERTA DE EMERG√äNCIA!';
                alertaNome.textContent = alerta.nome || '---';
                alertaSituacao.textContent = alerta.situacao || '---';
                alertaData.textContent = alerta.dataHora || '---';
                alertaMensagem.textContent = alerta.mensagem || '---';
                
                // Atualizar localiza√ß√£o
                if (alerta.localizacao) {
                    const lat = alerta.localizacao.lat.toFixed(6);
                    const lng = alerta.localizacao.lng.toFixed(6);
                    coordenadas.textContent = `${lat}, ${lng}`;
                    mapPlaceholder.innerHTML = `üìç SANTA MARIA<br><small>${lat}, ${lng}</small>`;
                    mapLink.href = `https://www.google.com/maps?q=${lat},${lng}`;
                    mapLink.classList.remove('disabled');
                } else {
                    coordenadas.textContent = '---, ---';
                    mapPlaceholder.innerHTML = 'üó∫Ô∏è LOCALIZA√á√ÉO N√ÉO COMPARTILHADA';
                    mapLink.classList.add('disabled');
                }
                
                // Ativar sirene automaticamente
                if (!sireneAtiva) {
                    ativarSirene();
                }
            } else {
                // Sem alerta ativo
                emergencyAlert.classList.add('inactive');
                emergencyTitle.innerHTML = '‚úÖ SISTEMA MONITORANDO';
                alertaNome.textContent = '---';
                alertaSituacao.textContent = '---';
                alertaData.textContent = '---';
                alertaMensagem.textContent = '---';
                coordenadas.textContent = '---, ---';
                mapPlaceholder.innerHTML = 'üó∫Ô∏è AGUARDANDO ALERTA';
                mapLink.classList.add('disabled');
                
                // Desativar sirene se n√£o houver alerta
                if (sireneAtiva) {
                    desativarSirene();
                }
            }
        }

        // Monitorar alertas
        function iniciarMonitoramento() {
            monitorInterval = setInterval(() => {
                try {
                    const alertaAtivo = localStorage.getItem('aurora_alerta_ativo') === 'true';
                    const ultimoAlerta = localStorage.getItem('aurora_ultimo_alerta');
                    
                    if (alertaAtivo && ultimoAlerta) {
                        const alerta = JSON.parse(ultimoAlerta);
                        atualizarAlerta(alerta);
                        statusConexao.innerHTML = 'üî¥ ALERTA ATIVO';
                        statusConexao.style.color = '#c32f3b';
                    } else {
                        atualizarAlerta(null);
                        statusConexao.innerHTML = 'üü¢ Monitorando';
                        statusConexao.style.color = '';
                    }
                } catch (e) {
                    console.error('Erro no monitoramento:', e);
                }
            }, 500); // Verificar a cada 500ms
        }

        // Limpar alerta
        function limparAlerta() {
            localStorage.removeItem('aurora_alerta_ativo');
            // Manter √∫ltimo alerta no hist√≥rico mas marcar como inativo
            const ultimoAlerta = localStorage.getItem('aurora_ultimo_alerta');
            if (ultimoAlerta) {
                try {
                    const alerta = JSON.parse(ultimoAlerta);
                    alerta.status = 'finalizado';
                    localStorage.setItem('aurora_ultimo_alerta', JSON.stringify(alerta));
                } catch (e) {}
            }
            atualizarAlerta(null);
        }

        // Reiniciar (simular novo alerta para teste)
        function reiniciarAlerta() {
            // Criar alerta de teste
            const alertaTeste = {
                id: Date.now(),
                nome: 'MARISA',
                situacao: 'Viol√™ncia f√≠sica',
                mensagem: 'Socorro, preciso de ajuda!',
                dataHora: new Date().toLocaleString('pt-BR'),
                timestamp: Date.now(),
                localizacao: {
                    lat: -16.020084,
                    lng: -48.020784
                },
                status: 'ativo'
            };
            
            localStorage.setItem('aurora_alerta_ativo', 'true');
            localStorage.setItem('aurora_ultimo_alerta', JSON.stringify(alertaTeste));
            atualizarAlerta(alertaTeste);
        }

        // Event listeners
        btnAtivar.addEventListener('click', ativarSirene);
        btnDesativar.addEventListener('click', desativarSirene);
        btnTestar.addEventListener('click', testarSirene);
        btnLimpar.addEventListener('click', limparAlerta);
        btnReiniciar.addEventListener('click', reiniciarAlerta);

        // Inicializar
        atualizarInterfaceSirene();
        iniciarMonitoramento();

        // Verificar alerta inicial
        const alertaInicial = localStorage.getItem('aurora_ultimo_alerta');
        const alertaAtivo = localStorage.getItem('aurora_alerta_ativo') === 'true';
        
        if (alertaInicial && alertaAtivo) {
            try {
                const alerta = JSON.parse(alertaInicial);
                atualizarAlerta(alerta);
            } catch (e) {}
        }

        // Limpeza ao sair
        window.addEventListener('beforeunload', () => {
            if (monitorInterval) clearInterval(monitorInterval);
            pararAudio();
        });
    </script>
</body>
</html>